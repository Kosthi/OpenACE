name: CI

on:
  push:
    branches: [master]
    paths-ignore:
      - "**.md"
      - "CLAUDE.md"
      - "**/CLAUDE.md"
      - "LICENSE"
      - ".gitignore"
      - "docs/**"
  pull_request:
    branches: [master]
    paths-ignore:
      - "**.md"
      - "CLAUDE.md"
      - "**/CLAUDE.md"
      - "LICENSE"
      - ".gitignore"
      - "docs/**"

jobs:
  # Skip CI when a release tag points at this commit (release workflow handles it)
  check-release:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    outputs:
      is-release: ${{ steps.check.outputs.is-release }}
    steps:
      - uses: actions/checkout@v4
      - id: check
        run: |
          git fetch --tags
          if git tag --points-at HEAD | grep -q '^v'; then
            echo "is-release=true" >> "$GITHUB_OUTPUT"
          else
            echo "is-release=false" >> "$GITHUB_OUTPUT"
          fi

  build:
    needs: check-release
    if: |
      always() &&
      (needs.check-release.result == 'skipped' || needs.check-release.outputs.is-release != 'true')
    uses: ./.github/workflows/build.yml
